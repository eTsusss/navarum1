# Исправление проблемы с базой данных на Render.com

## Проблема
После "сна" сервера на Render.com товары исчезают из базы данных. Это происходит потому, что SQLite база данных `products.db` создается во временной директории, которая очищается при перезапуске сервиса.

## Решение
Использовать переменную окружения `RENDER_PROJECT_DIR` для хранения базы данных в постоянной директории.

## Внесенные изменения

### 1. server/app.py
- Добавлена функция `get_db_path()` для получения пути к базе данных
- Все подключения к `products.db` заменены на `get_db_path()`
- База данных теперь сохраняется в постоянной директории на Render.com

### 2. server/migrate_db.py
- Добавлена функция `get_db_path()`
- Автоматическое создание базы данных если она не существует

### 3. server/update_categories.py
- Добавлена функция `get_db_path()`
- Автоматическое создание базы данных если она не существует

## Настройка на Render.com

### 1. Добавить переменную окружения
В настройках сервиса на Render.com добавьте:
```
RENDER_PROJECT_DIR = /opt/render/project/src
```

### 2. Перезапустить сервис
После добавления переменной окружения перезапустите сервис.

### 3. Проверить работу
- База данных должна создаться в постоянной директории
- Товары должны сохраняться между перезапусками

## Альтернативное решение
Если проблема сохраняется, можно использовать PostgreSQL вместо SQLite:

1. Создать PostgreSQL сервис на Render.com
2. Изменить код для работы с PostgreSQL
3. Использовать переменные окружения для подключения

## Проверка
После развертывания:
1. Добавьте несколько товаров
2. Перезапустите сервис
3. Убедитесь, что товары остались в базе данных

## Логи
В логах должно быть:
```
Retrieved X products from database
GET /api/products HTTP/1.1 200 [размер_ответа]
```

Если размер ответа маленький (например, 3273), значит товаров мало или их нет.
Если размер ответа большой (например, 6764285), значит товары есть.
